<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>12306 - 登录</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft Yahei", sans-serif;
    }

    body {
      background-color: #f5f5f5;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* 顶部导航（和原页面统一） */
    .header {
      background-color: #fff;
      border-bottom: 2px solid #d92121;
    }

    /* 背景图区域 */
    .main-content {
      background-image: url('./bg-login.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: calc(100vh - 70px);
      padding: 50px 0;
    }
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
    }
    .logo {
      font-size: 28px;
      color: #d92121;
      font-weight: bold;
    }
    .nav {
      display: flex;
      gap: 30px;
    }
    .nav-item {
      color: #333;
      font-size: 16px;
      cursor: pointer;
    }
    .nav-item:hover {
      color: #d92121;
    }
    .back-home {
      color: #d92121;
      cursor: pointer;
      font-weight: bold;
    }

    /* 登录注册容器 */
    .login-container {
      max-width: 400px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 4px;
      padding: 30px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .login-title {
      font-size: 22px;
      color: #333;
      margin-bottom: 20px;
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    /* 登录/注册标签切换 */
    .tab-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 8px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-size: 16px;
    }
    .tab.active {
      color: #d92121;
      border-bottom: 2px solid #d92121;
    }
    /* 表单样式 */
    .form-item {
      margin-bottom: 15px;
    }
    .form-item label {
      display: block;
      margin-bottom: 5px;
      color: #666;
      font-size: 14px;
    }
    .form-item input {
      width: 100%;
      height: 40px;
      padding: 0 10px;
      border: 1px solid #ccc;
      border-radius: 2px;
      font-size: 16px;
    }
    .form-item input:focus {
      outline: none;
      border-color: #d92121;
    }
    /* 按钮样式 */
    .submit-btn {
      width: 100%;
      height: 45px;
      background-color: #d92121;
      color: #fff;
      border: none;
      border-radius: 2px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 10px;
    }
    .submit-btn:hover {
      background-color: #b91c1c;
    }
    /* 表单容器（默认隐藏注册） */
    .form-container {
      display: none;
    }
    .form-container.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- 顶部导航 -->
  <div class="header">
    <div class="container header-inner">
      <div class="logo">中国铁路12306</div>
      <div class="nav">
        <!-- 跳转同目录的12306.html -->
        <div class="nav-item" onclick="window.location.href='./12306.html'">车票预订</div>
        <div class="nav-item" onclick="window.location.href='./12306.html'">订单查询</div>
        <div class="nav-item" onclick="window.location.href='./12306.html'">我的12306</div>
      </div>
      <!-- 跳转同目录的12306.html -->
      <div class="back-home" onclick="window.location.href='./12306.html'">返回首页</div>
    </div>
  </div>

  <!-- 背景图区域 -->
  <div class="main-content">
    <!-- 登录注册主体 -->
    <div class="container">
      <div class="login-container">
      <div class="login-title">用户登录/注册</div>
      
      <!-- 标签切换 -->
      <div class="tab-group">
        <div class="tab active" id="loginTab">登录</div>
        <div class="tab" id="registerTab">注册</div>
      </div>

      <!-- 登录表单 -->
      <div class="form-container active" id="loginForm">
        <div class="form-item">
          <label for="loginUsername">用户名</label>
          <input type="text" id="loginUsername" placeholder="请输入注册的用户名">
        </div>
        <div class="form-item">
          <label for="loginPassword">密码</label>
          <input type="password" id="loginPassword" placeholder="请输入密码">
        </div>
        <button class="submit-btn" id="loginBtn">登录</button>
      </div>

      <!-- 注册表单 -->
      <div class="form-container" id="registerForm">
        <div class="form-item">
          <label for="registerUsername">用户名</label>
          <input type="text" id="registerUsername" placeholder="请设置用户名">
        </div>
        <div class="form-item">
          <label for="registerPassword">密码</label>
          <input type="password" id="registerPassword" placeholder="请设置密码（6位以上）">
        </div>
        <div class="form-item">
          <label for="confirmPassword">确认密码</label>
          <input type="password" id="confirmPassword" placeholder="请再次输入密码">
        </div>
        <button class="submit-btn" id="registerBtn">注册</button>
      </div>
    </div>
  </div>
  </div>

  <script>
    // 1. 标签切换逻辑
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');

    loginTab.addEventListener('click', function() {
      loginTab.classList.add('active');
      registerTab.classList.remove('active');
      loginForm.classList.add('active');
      registerForm.classList.remove('active');
    });

    registerTab.addEventListener('click', function() {
      registerTab.classList.add('active');
      loginTab.classList.remove('active');
      registerForm.classList.add('active');
      loginForm.classList.remove('active');
    });

    // 2. 注册功能（对接MySQL后端接口）
    const registerBtn = document.getElementById('registerBtn');
    registerBtn.addEventListener('click', async function() {
      const username = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value.trim();
      const confirmPwd = document.getElementById('confirmPassword').value.trim();

      // 前端基础校验
      if (!username || !password || !confirmPwd) {
        alert('请填写完整的注册信息！');
        return;
      }
      if (password.length < 6) {
        alert('密码长度需不少于6位！');
        return;
      }
      if (password !== confirmPwd) {
        alert('两次输入的密码不一致！');
        return;
      }

      try {
        // 调用后端注册接口（适配你的3000端口）
        const response = await fetch('http://localhost:3000/api/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            username: username, 
            password: password 
          })
        });

        const result = await response.json();
        if (result.code === 0) {
          alert('注册成功！请登录');
          // 切换到登录表单并清空注册表单
          loginTab.click();
          document.getElementById('registerUsername').value = '';
          document.getElementById('registerPassword').value = '';
          document.getElementById('confirmPassword').value = '';
        } else {
          alert('注册失败：' + result.msg);
        }
      } catch (error) {
        console.error('注册请求失败：', error);
        alert('注册失败！请检查后端服务是否启动（http://localhost:3000）');
      }
    });

    // 3. 登录功能（对接MySQL后端接口）
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.addEventListener('click', async function() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      // 前端基础校验
      if (!username || !password) {
        alert('请填写用户名和密码！');
        return;
      }

      try {
        // 调用后端登录接口
        const response = await fetch('http://localhost:3000/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            username: username, 
            password: password 
          })
        });

        const result = await response.json();
        if (result.code === 0) {
          alert('登录成功！即将返回首页');
          // 保存登录状态到前端localStorage（仅用于显示）
          localStorage.setItem('12306_loginUser', JSON.stringify({
            username: result.data.username,
            userId: result.data.userId
          }));
          // 跳转回12306首页
          window.location.href = './12306.html';
        } else {
          alert('登录失败：' + result.msg);
        }
      } catch (error) {
        console.error('登录请求失败：', error);
        alert('登录失败！请检查后端服务是否启动（http://localhost:3000）');
      }
    });
  </script>
</body>
</html>