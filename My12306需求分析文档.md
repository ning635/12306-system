# My12306 火车票预订系统 - 需求分析文档

**版本**：v1.0  
**日期**：2025年12月24日  
**项目名称**：My12306 模拟购票系统

---

## 目录

- [1. 引言](#1-引言)
  - [1.1 编写目的](#11-编写目的)
  - [1.2 项目背景](#12-项目背景)
  - [1.3 术语定义](#13-术语定义)
- [2. 总体描述](#2-总体描述)
  - [2.1 产品愿景](#21-产品愿景)
  - [2.2 用户特征](#22-用户特征)
  - [2.3 运行环境](#23-运行环境)
  - [2.4 约束条件](#24-约束条件)
- [3. 功能需求](#3-功能需求)
  - [3.1 用户认证模块](#31-用户认证模块)
  - [3.2 车票预订模块](#32-车票预订模块)
  - [3.3 订单管理模块](#33-订单管理模块)
  - [3.4 个人中心模块](#34-个人中心模块)
  - [3.5 支付绑定模块](#35-支付绑定模块)
- [4. 非功能需求](#4-非功能需求)
  - [4.1 性能需求](#41-性能需求)
  - [4.2 安全需求](#42-安全需求)
  - [4.3 可用性需求](#43-可用性需求)
  - [4.4 兼容性需求](#44-兼容性需求)
- [5. 数据需求](#5-数据需求)
  - [5.1 数据实体](#51-数据实体)
  - [5.2 数据字典](#52-数据字典)
- [6. 接口需求](#6-接口需求)
  - [6.1 用户界面需求](#61-用户界面需求)
  - [6.2 外部接口需求](#62-外部接口需求)

---

## 1. 引言

### 1.1 编写目的

本文档旨在明确 My12306 火车票预订系统的功能需求与非功能需求，为系统设计、开发和测试提供依据。通过本文档，开发团队可以清晰了解系统的功能边界、业务流程和技术约束。

### 1.2 项目背景

My12306 是一个模拟中国铁路12306官方购票平台的 Web 应用系统。该系统旨在通过模拟真实的火车票预订业务流程，帮助开发者学习和实践 Web 全栈开发技术。

**项目特点**：
- 模拟真实12306的核心业务流程
- 覆盖用户注册、身份认证、购票、支付、订单管理等完整功能链
- 采用前后端分离架构

### 1.3 术语定义

| 术语 | 定义 |
|------|------|
| 候补购票 | 当所选车次无票时，用户可提交候补订单，系统在有票时自动为用户购票 |
| 改签 | 将已购车票更换为其他日期或车次的车票 |
| 常用乘车人 | 用户预先添加的乘客信息，购票时可快速选择 |
| 实名认证 | 用户提交真实姓名、身份证号进行身份验证的过程 |
| 席别 | 火车座位类型，包括一等座、二等座、无座等 |

---

## 2. 总体描述

### 2.1 产品愿景

构建一个功能完整、界面友好、操作便捷的火车票在线预订模拟平台，使用户能够：

- 快速查询火车班次信息
- 便捷完成在线购票流程
- 高效管理个人订单
- 安全绑定和使用多种支付方式

### 2.2 用户特征

| 用户角色 | 描述 | 主要需求 |
|----------|------|----------|
| 普通旅客 | 偶尔出行的用户 | 查询车次、购票、查看订单 |
| 常旅客 | 频繁出行的用户 | 管理常用乘客、快速购票、历史订单查询 |
| 新用户 | 首次使用系统的用户 | 注册账号、完成实名认证、绑定支付方式 |

### 2.3 运行环境

**客户端环境**：
- 现代浏览器（Chrome、Firefox、Safari、Edge）
- 支持 ES6+ JavaScript
- 支持 CSS3 和 HTML5

**服务端环境**：
- Node.js 运行环境
- MySQL 数据库
- HTTP 网络协议

### 2.4 约束条件

1. 所有支付功能为模拟实现，不涉及真实资金交易
2. 车次数据使用本地静态数据，不连接真实铁路数据接口
3. 用户敏感信息（身份证、手机号）需脱敏显示
4. 购票前必须完成实名认证

---

## 3. 功能需求

### 3.1 用户认证模块

#### 3.1.1 用户注册

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-AUTH-001 |
| 功能名称 | 用户注册 |
| 优先级 | 高 |
| 功能描述 | 用户通过填写用户名和密码完成账号注册 |
| 前置条件 | 用户未登录 |
| 输入 | 用户名、密码、确认密码 |
| 处理逻辑 | 1. 校验用户名格式<br>2. 校验两次密码一致<br>3. 检查用户名是否已存在<br>4. 创建新用户账号 |
| 输出 | 注册成功提示，跳转登录页 |
| 异常处理 | 用户名已存在时提示错误 |

#### 3.1.2 用户登录

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-AUTH-002 |
| 功能名称 | 用户登录 |
| 优先级 | 高 |
| 功能描述 | 已注册用户通过用户名和密码登录系统 |
| 前置条件 | 用户已注册 |
| 输入 | 用户名、密码 |
| 处理逻辑 | 1. 校验用户名和密码<br>2. 验证通过后保存登录状态<br>3. 跳转至主页面 |
| 输出 | 登录成功，显示用户信息 |
| 异常处理 | 用户名或密码错误时提示 |

#### 3.1.3 实名认证

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-AUTH-003 |
| 功能名称 | 实名认证 |
| 优先级 | 高 |
| 功能描述 | 用户提交真实姓名、身份证号、手机号完成实名认证 |
| 前置条件 | 用户已登录且未认证 |
| 输入 | 真实姓名、身份证号（18位）、手机号（11位） |
| 处理逻辑 | 1. 校验身份证号格式<br>2. 校验手机号格式<br>3. 保存认证信息<br>4. 更新认证状态 |
| 输出 | 认证成功提示 |
| 业务规则 | 未实名认证的用户无法购票 |

#### 3.1.4 退出登录

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-AUTH-004 |
| 功能名称 | 退出登录 |
| 优先级 | 中 |
| 功能描述 | 用户退出当前登录状态 |
| 处理逻辑 | 清除本地登录状态，跳转至登录页 |

---

### 3.2 车票预订模块

#### 3.2.1 车次查询

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-TICKET-001 |
| 功能名称 | 车次查询 |
| 优先级 | 高 |
| 功能描述 | 用户根据出发地、目的地、出发日期查询火车班次 |
| 输入 | 出发城市、到达城市、出发日期、席别（可选） |
| 处理逻辑 | 1. 校验查询条件完整性<br>2. 根据条件筛选车次<br>3. 当天查询时过滤已发车车次<br>4. 返回匹配的车次列表 |
| 输出 | 车次列表（车次号、出发站、到达站、出发时间、到达时间、历时、票价、余票） |
| 业务规则 | 查询当天车次时，只显示尚未发车的车次 |

#### 3.2.2 车票预订

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-TICKET-002 |
| 功能名称 | 车票预订 |
| 优先级 | 高 |
| 功能描述 | 用户选择车次后进行预订 |
| 前置条件 | 用户已登录且已实名认证 |
| 输入 | 选定车次、席别、乘客、支付方式 |
| 处理逻辑 | 1. 验证用户登录和实名状态<br>2. 显示预订确认弹窗<br>3. 用户选择席别和乘客<br>4. 用户选择支付方式<br>5. 创建订单并完成支付 |
| 输出 | 订单创建成功，显示订单号 |

#### 3.2.3 席别选择

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-TICKET-003 |
| 功能名称 | 席别选择 |
| 优先级 | 高 |
| 功能描述 | 用户在预订时选择座位类型 |
| 可选项 | 一等座、二等座、无座 |
| 业务规则 | 1. 显示各席别余票数量<br>2. 已售罄席别标记为"可候补"<br>3. 不同席别对应不同票价 |

#### 3.2.4 乘客选择

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-TICKET-004 |
| 功能名称 | 乘客选择 |
| 优先级 | 高 |
| 功能描述 | 用户在预订时选择乘车人 |
| 可选项 | 本人、常用乘车人列表 |
| 业务规则 | 默认选中"本人"，可切换为已添加的常用乘车人 |

#### 3.2.5 候补购票

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-TICKET-005 |
| 功能名称 | 候补购票 |
| 优先级 | 中 |
| 功能描述 | 当所选席别无票时，用户可提交候补订单 |
| 前置条件 | 所选席别余票为0 |
| 处理逻辑 | 1. 创建候补订单<br>2. 订单状态设为"候补中"<br>3. 无需立即支付 |
| 业务规则 | 候补订单不立即扣款，等待系统通知 |

---

### 3.3 订单管理模块

#### 3.3.1 订单列表查询

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-ORDER-001 |
| 功能名称 | 订单列表查询 |
| 优先级 | 高 |
| 功能描述 | 用户查看个人所有订单记录 |
| 前置条件 | 用户已登录 |
| 输出 | 订单列表（订单号、出发地、目的地、车次、票价、状态、操作按钮） |
| 排序规则 | 按创建时间倒序排列 |

#### 3.3.2 订单状态

| 状态值 | 中文名称 | 说明 | 可执行操作 |
|--------|----------|------|------------|
| pending | 待支付 | 订单已创建，等待支付 | 继续支付、取消订单 |
| paid | 已支付 | 支付成功，车票有效 | 退票、改签 |
| waitlist | 候补中 | 无票时的候补订单 | 取消候补 |
| cancelled | 已取消 | 用户主动取消 | 无 |
| refunded | 已退票 | 已支付订单申请退票 | 无 |
| rescheduled | 已改签 | 原订单已改签至新订单 | 无 |

#### 3.3.3 退票

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-ORDER-002 |
| 功能名称 | 退票 |
| 优先级 | 高 |
| 功能描述 | 用户对已支付订单申请退票 |
| 前置条件 | 订单状态为"已支付" |
| 处理逻辑 | 1. 确认退票<br>2. 更新订单状态为"已退票"<br>3. 模拟退款（实际不涉及资金） |
| 输出 | 退票成功提示 |

#### 3.3.4 改签

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-ORDER-003 |
| 功能名称 | 改签 |
| 优先级 | 中 |
| 功能描述 | 用户将已支付订单改签至其他日期或车次 |
| 前置条件 | 订单状态为"已支付"，列车尚未发车 |
| 输入 | 新出发日期、新车次（可选）、新席别 |
| 处理逻辑 | 1. 原订单状态改为"已改签"<br>2. 创建新订单<br>3. 计算并处理差价 |
| 输出 | 改签成功，显示新订单号 |
| 业务规则 | 差价为正需补款，差价为负则退款 |

#### 3.3.5 取消订单

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-ORDER-004 |
| 功能名称 | 取消订单/取消候补 |
| 优先级 | 中 |
| 功能描述 | 用户取消待支付订单或候补订单 |
| 前置条件 | 订单状态为"待支付"或"候补中" |
| 处理逻辑 | 更新订单状态为"已取消" |

---

### 3.4 个人中心模块

#### 3.4.1 个人信息展示

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-USER-001 |
| 功能名称 | 个人信息展示 |
| 优先级 | 中 |
| 功能描述 | 展示当前登录用户的基本信息 |
| 展示内容 | 头像、用户名、手机号（脱敏）、身份证号（脱敏）、实名认证状态 |
| 脱敏规则 | 手机号：138****8000<br>身份证：440***********1234 |

#### 3.4.2 头像上传

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-USER-002 |
| 功能名称 | 头像上传 |
| 优先级 | 低 |
| 功能描述 | 用户上传个人头像 |
| 输入 | 图片文件（支持 jpg、png 等格式） |
| 处理逻辑 | 1. 校验文件类型<br>2. 校验文件大小（≤2MB）<br>3. 转换为 Base64 存储 |
| 输出 | 头像更新成功 |

#### 3.4.3 常用乘车人管理

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-USER-003 |
| 功能名称 | 常用乘车人管理 |
| 优先级 | 高 |
| 功能描述 | 用户添加、查看、删除常用乘车人信息 |

**添加乘车人**：

| 输入字段 | 格式要求 | 是否必填 |
|----------|----------|----------|
| 姓名 | 中文姓名 | 是 |
| 身份证号 | 18位，最后一位可为X | 是 |
| 手机号 | 11位数字，1开头 | 是 |

**业务规则**：
- 同一用户下，同一身份证号只能添加一次
- 常用乘车人信息在购票时可快速选择

---

### 3.5 支付绑定模块

#### 3.5.1 支付方式绑定

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-PAY-001 |
| 功能名称 | 支付方式绑定 |
| 优先级 | 高 |
| 功能描述 | 用户绑定支付账号，用于购票时快速支付 |

**支持的支付方式**：

| 支付方式 | 图标 | 绑定信息 | 支付验证方式 |
|----------|------|----------|--------------|
| 微信支付 | 🟢 | 微信账号 | 扫码支付 |
| 支付宝 | 🔵 | 支付宝账号 | 扫码支付 |
| Apple Pay |  | Apple ID | 指纹/面容验证 |
| 银联 | 🔴 | 银行卡号 | 密码验证 |
| 其他 | ⚪ | 账号 | - |

#### 3.5.2 支付方式解绑

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-PAY-002 |
| 功能名称 | 支付方式解绑 |
| 优先级 | 中 |
| 功能描述 | 用户解除已绑定的支付方式 |
| 处理逻辑 | 确认后删除绑定记录 |

#### 3.5.3 支付流程

| 需求项 | 描述 |
|--------|------|
| 需求编号 | FR-PAY-003 |
| 功能名称 | 模拟支付 |
| 优先级 | 高 |
| 功能描述 | 购票时使用已绑定的支付方式完成支付 |
| 业务规则 | 1. 未绑定的支付方式不可选择<br>2. 不同支付方式显示不同的支付界面<br>3. 所有支付为模拟流程，不涉及真实交易 |

---

## 4. 非功能需求

### 4.1 性能需求

| 需求项 | 指标 |
|--------|------|
| 页面加载时间 | ≤ 3秒 |
| 车次查询响应时间 | ≤ 1秒 |
| 订单创建响应时间 | ≤ 2秒 |
| 并发用户数 | 支持 100 用户同时在线 |
| 查询防抖间隔 | 800毫秒 |

### 4.2 安全需求

| 需求项 | 描述 |
|--------|------|
| 输入校验 | 对所有用户输入进行格式校验，防止非法数据 |
| SQL注入防护 | 使用参数化查询，防止SQL注入攻击 |
| 敏感信息脱敏 | 身份证号、手机号在页面显示时部分隐藏 |
| 密码存储 | 密码不以明文存储（生产环境需加密） |

### 4.3 可用性需求

| 需求项 | 描述 |
|--------|------|
| 界面风格 | 参考12306官方网站，红色主题色 |
| 操作反馈 | 所有操作需有明确的成功/失败提示 |
| 表单验证 | 输入错误时即时提示，减少用户试错成本 |
| 页面导航 | 清晰的导航结构，用户可快速定位所需功能 |

### 4.4 兼容性需求

| 浏览器 | 最低版本 |
|--------|----------|
| Chrome | 90+ |
| Firefox | 88+ |
| Safari | 14+ |
| Edge | 90+ |

---

## 5. 数据需求

### 5.1 数据实体

系统涉及以下核心数据实体：

```
┌─────────────┐         1:N         ┌──────────────┐
│    用户     │─────────────────────│    订单      │
│   (user)    │                     │  (orders)    │
└─────────────┘                     └──────────────┘
      │
      │ 1:N
      ▼
┌─────────────────────┐
│    常用乘车人        │
│(frequent_passengers)│
└─────────────────────┘
```

### 5.2 数据字典

#### 5.2.1 用户信息

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | 整数 | 是 | 用户唯一标识 |
| username | 字符串 | 是 | 用户名，唯一 |
| password | 字符串 | 是 | 登录密码 |
| name | 字符串 | 否 | 真实姓名 |
| phone | 字符串 | 否 | 手机号（11位） |
| id_card | 字符串 | 否 | 身份证号（18位） |
| is_verified | 布尔 | 是 | 是否已实名认证 |
| avatar | 文本 | 否 | 头像（Base64） |

#### 5.2.2 订单信息

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| order_no | 字符串 | 是 | 订单号（10位唯一） |
| user_id | 整数 | 是 | 所属用户ID |
| start_city | 字符串 | 是 | 出发城市 |
| end_city | 字符串 | 是 | 到达城市 |
| train_no | 字符串 | 是 | 车次号 |
| price | 数字 | 是 | 票价 |
| depart_time | 日期时间 | 是 | 出发时间 |
| seat_type | 字符串 | 是 | 席别 |
| status | 枚举 | 是 | 订单状态 |
| payment_method | 字符串 | 否 | 支付方式 |
| passenger_name | 字符串 | 否 | 乘客姓名 |
| passenger_id_card | 字符串 | 否 | 乘客身份证 |
| passenger_phone | 字符串 | 否 | 乘客电话 |

#### 5.2.3 常用乘车人

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | 整数 | 是 | 记录ID |
| user_id | 整数 | 是 | 所属用户ID |
| passenger_name | 字符串 | 是 | 乘客姓名 |
| passenger_id_card | 字符串 | 是 | 身份证号 |
| passenger_phone | 字符串 | 否 | 手机号 |

---

## 6. 接口需求

### 6.1 用户界面需求

#### 6.1.1 页面结构

系统采用单页面应用（SPA）架构，包含以下页面：

| 页面 | 功能 | 入口 |
|------|------|------|
| 首页（车票预订） | 车次查询与预订 | 导航栏"车票预订" |
| 订单管理 | 查看和管理订单 | 导航栏"订单查询" |
| 个人中心 | 用户信息管理 | 导航栏"我的12306" |
| 常用乘车人 | 乘车人管理 | 个人中心入口 |
| 支付绑定 | 支付方式管理 | 导航栏"支付绑定" |
| 使用指南 | 功能说明 | 导航栏"购票指南" |

#### 6.1.2 弹窗组件

| 弹窗 | 触发场景 | 主要内容 |
|------|----------|----------|
| 预订确认弹窗 | 点击"预订"按钮 | 席别选择、乘客选择、支付方式 |
| 支付弹窗 | 确认支付 | 二维码/密码输入/验证界面 |
| 改签弹窗 | 点击"改签"按钮 | 新日期、新车次、新席别选择 |
| 身份验证弹窗 | 首次购票 | 姓名、身份证、手机号输入 |

### 6.2 外部接口需求

#### 6.2.1 API 接口列表

| 模块 | 接口 | 方法 | 功能 |
|------|------|------|------|
| 认证 | /api/register | POST | 用户注册 |
| 认证 | /api/login | POST | 用户登录 |
| 认证 | /api/verify | POST | 实名认证 |
| 订单 | /api/orders | GET | 查询订单列表 |
| 订单 | /api/orders | POST | 创建订单 |
| 订单 | /api/orders/:orderNo/cancel | PATCH | 取消/退票 |
| 订单 | /api/orders/reschedule | PATCH | 改签订单 |
| 乘客 | /api/frequent_passengers | GET | 查询常用乘客 |
| 乘客 | /api/frequent_passengers | POST | 添加常用乘客 |
| 乘客 | /api/frequent_passengers/:id | DELETE | 删除常用乘客 |

#### 6.2.2 响应格式

所有 API 响应采用统一 JSON 格式：

```json
{
  "code": 0,       // 状态码：0成功，-1失败
  "msg": "提示信息",
  "data": {}       // 响应数据
}
```

---

## 附录：需求追踪矩阵

| 需求编号 | 需求名称 | 优先级 | 状态 |
|----------|----------|--------|------|
| FR-AUTH-001 | 用户注册 | 高 | 已实现 |
| FR-AUTH-002 | 用户登录 | 高 | 已实现 |
| FR-AUTH-003 | 实名认证 | 高 | 已实现 |
| FR-AUTH-004 | 退出登录 | 中 | 已实现 |
| FR-TICKET-001 | 车次查询 | 高 | 已实现 |
| FR-TICKET-002 | 车票预订 | 高 | 已实现 |
| FR-TICKET-003 | 席别选择 | 高 | 已实现 |
| FR-TICKET-004 | 乘客选择 | 高 | 已实现 |
| FR-TICKET-005 | 候补购票 | 中 | 已实现 |
| FR-ORDER-001 | 订单列表查询 | 高 | 已实现 |
| FR-ORDER-002 | 退票 | 高 | 已实现 |
| FR-ORDER-003 | 改签 | 中 | 已实现 |
| FR-ORDER-004 | 取消订单 | 中 | 已实现 |
| FR-USER-001 | 个人信息展示 | 中 | 已实现 |
| FR-USER-002 | 头像上传 | 低 | 已实现 |
| FR-USER-003 | 常用乘车人管理 | 高 | 已实现 |
| FR-PAY-001 | 支付方式绑定 | 高 | 已实现 |
| FR-PAY-002 | 支付方式解绑 | 中 | 已实现 |
| FR-PAY-003 | 模拟支付 | 高 | 已实现 |

---

**文档结束**
